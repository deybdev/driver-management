<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- IMPORT CSS -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/schedule.css" />
    <!-- ICONIFY CDN -->
    <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
    <!-- MAP API -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"
    />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

    <title>Schedule</title>
  </head>
  <body onload="getCurrentLocation()">
    <!-- NAVBAR (Reusable when using backend via PHP include) -->
    <nav id="sidebar" class="sidebar">
      <!-- LOGO -->
      <div>
        <img src="assets/logo.png" alt="" />
      </div>
      <p>MENU</p>
      <ul>
        <li onclick="this.querySelector('a').click()">
          <span
            class="iconify"
            data-icon="material-symbols:dashboard-rounded"
          ></span
          ><a href="dashboard.html"> Dashboard</a>
        </li>

        <li class="active" onclick="this.querySelector('a').click()">
          <span class="iconify" data-icon="uis:schedule"></span>
          <a href="schedule.html"> Schedule</a>
        </li>

        <li onclick="this.querySelector('a').click()">
          <span class="iconify" data-icon="ic:round-message"></span
          ><a href="message.html"> Messages</a>
        </li>
        <li onclick="this.querySelector('a').click()">
          <span class="iconify" data-icon="solar:wallet-bold"></span
          ><a href="wallet.html"> My Wallet</a>
        </li>
        <li onclick="this.querySelector('a').click()">
          <span class="iconify" data-icon="fa-solid:history"></span
          ><a href="history.html"> Compliance</a>
        </li>
        <li onclick="this.querySelector('a').click()">
          <span class="iconify" data-icon="iconamoon:profile-fill"></span
          ><a href="profile.html"> Profile</a>
        </li>
      </ul>
    </nav>

    <div class="main-content">
      <div class="schedule-header">
        <div class="schedule-text-header">
          <h2>Schedule</h2>
          <p>Manage your bookings and vehicle assignments</p>
        </div>
      </div>

      <!-- PILL TOGGLE -->
      <div class="pill-toggle-container">
        <div class="pill-toggle-group">
          <input
            type="radio"
            id="bookings-tab"
            name="schedule-tab"
            value="bookings"
            checked
          />
          <label for="bookings-tab" class="pill-tab">Bookings</label>

          <input
            type="radio"
            id="ongoing-tab"
            name="schedule-tab"
            value="ongoing"
          />
          <label for="ongoing-tab" class="pill-tab">Ongoing</label>

          <input
            type="radio"
            id="coding-tab"
            name="schedule-tab"
            value="coding"
          />
          <label for="coding-tab" class="pill-tab">Vehicle Coding</label>
        </div>
      </div>

      <!-- AVAILABLE BOOKINGS -->
      <div class="bookings-container" id="bookings-section">
        <div class="bookings-header">
          <h3>Available Bookings</h3>
          <p>Browse and accept client bookings</p>
        </div>

        <div class="bookings-grid" id="bookings-container">
          <div class="booking-card template" style="display: none">
            <div class="booking-header">
              <div class="distance-info">
                <span class="iconify" data-icon="material-symbols:route"></span>
                <span class="distance">0 km from you</span>
              </div>
              <p class="time">Time</p>
            </div>

            <div class="client-info">
              <span class="iconify" data-icon="iconamoon:profile-fill"></span>
              <span class="client-name">Client Name</span>
            </div>

            <div class="route-container">
              <div class="route-point pickup">
                <div class="route-icon pickup-icon">
                  <span class="iconify" data-icon="ic:outline-circle"></span>
                </div>
                <div class="route-details">
                  <div class="pickup-address">Pickup Address</div>
                </div>
              </div>

              <div class="route-point dropoff">
                <div class="route-icon dropoff-icon">
                  <span class="iconify" data-icon="mdi:location"></span>
                </div>
                <div class="route-details">
                  <div class="dropoff-address">Dropoff Address</div>
                </div>
              </div>
            </div>

            <div class="booking-note">
              <p class="note-text">Note</p>
            </div>

            <div class="booking-fare">
              <span class="fare">₱0.00</span>
            </div>
            <div class="booking-action">
              <button class="accept-btn">Accept</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ONGOING BOOKINGS CONTAINER -->
      <div class="bookings-container" id="ongoing-section">
        <div class="bookings-header">
          <h3>Ongoing Bookings</h3>
          <p>Track your current active rides</p>
        </div>

        <div class="bookings-grid" id="ongoing-container">
          <div class="booking-card ongoing template" style="display: none">
            <div class="booking-header">
              <div class="status-info">
                <span class="iconify" data-icon="material-symbols:directions-car"></span>
                <span class="status-text">Status</span>
              </div>
            </div>

            <div class="client-info">
              <span class="iconify" data-icon="iconamoon:profile-fill"></span>
              <span class="client-name">Client Name</span>
            </div>

            <div class="route-container">
              <div class="route-point pickup">
                <div class="route-icon pickup-icon">
                  <span class="iconify" data-icon="ic:outline-circle"></span>
                </div>
                <div class="route-details">
                  <div class="pickup-address">Pickup Address</div>
                </div>
              </div>

              <div class="route-point dropoff">
                <div class="route-icon dropoff-icon">
                  <span class="iconify" data-icon="mdi:location"></span>
                </div>
                <div class="route-details">
                  <div class="dropoff-address">Dropoff Address</div>
                </div>
              </div>
            </div>

            <div class="booking-note">
              <p class="note-text">Note</p>
            </div>

            <div class="booking-fare">
              <span class="fare">₱0.00</span>
            </div>
          </div>
        </div>
      </div>

      <!-- VEHICLE CODING CONTAINER -->
      <div class="bookings-container" id="coding-section">
        <div class="bookings-header">
          <div class="header-content">
            <div class="header-text">
              <h3>Vehicle Coding Schedule</h3>
              <p>View number coding restrictions and allowed driving days</p>
            </div>
          </div>
        </div>

        <div class="coding-content">
          <!-- Coding Information Card -->
          <div class="coding-info-card">
            <div class="coding-header">
              <span class="iconify" data-icon="mdi:car-info"></span>
              <h4>Number Coding Scheme</h4>
            </div>
            <p class="coding-description">
              The Unified Vehicular Volume Reduction Program (UVVRP), commonly known as the "Number Coding Scheme",
              prohibits certain vehicles from using specified public roads during peak hours.
            </p>
            <div class="coding-hours">
              <div class="coding-time">
                <span class="iconify" data-icon="mdi:clock-outline"></span>
                <span><strong>Morning:</strong> 7:00 AM - 10:00 AM</span>
              </div>
              <div class="coding-time">
                <span class="iconify" data-icon="mdi:clock-outline"></span>
                <span><strong>Evening:</strong> 5:00 PM - 8:00 PM</span>
              </div>
            </div>
          </div>

          <!-- Coding Schedule Table -->
          <div class="coding-table-wrapper">
            <table class="coding-table">
              <thead>
                <tr>
                  <th>Day</th>
                  <th>Plate Number Ending</th>
                  <th>Status</th>
                  <th>Restricted Hours</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Monday</strong></td>
                  <td>1 & 2</td>
                  <td><span class="status-badge allowed">Allowed</span></td>
                  <td>-</td>
                </tr>
                <tr>
                  <td><strong>Tuesday</strong></td>
                  <td>3 & 4</td>
                  <td><span class="status-badge allowed">Allowed</span></td>
                  <td>-</td>
                </tr>
                <tr>
                  <td><strong>Wednesday</strong></td>
                  <td>5 & 6</td>
                  <td><span class="status-badge allowed">Allowed</span></td>
                  <td>-</td>
                </tr>
                <tr>
                  <td><strong>Thursday</strong></td>
                  <td>7 & 8</td>
                  <td><span class="status-badge allowed">Allowed</span></td>
                  <td>-</td>
                </tr>
                <tr>
                  <td><strong>Friday</strong></td>
                  <td>9 & 0</td>
                  <td><span class="status-badge allowed">Allowed</span></td>
                  <td>-</td>
                </tr>
                <tr class="weekend-row">
                  <td><strong>Saturday</strong></td>
                  <td>All</td>
                  <td><span class="status-badge no-coding">No Coding</span></td>
                  <td>All Day Free</td>
                </tr>
                <tr class="weekend-row">
                  <td><strong>Sunday</strong></td>
                  <td>All</td>
                  <td><span class="status-badge no-coding">No Coding</span></td>
                  <td>All Day Free</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Vehicle Registration Card -->
          <div class="vehicle-card">
            <div class="vehicle-header">
              <div class="vehicle-icon">
                <span class="iconify" data-icon="mdi:car"></span>
              </div>
              <div class="vehicle-info">
                <h4>Your Vehicle</h4>
                <p class="plate-number">ABC 1234</p>
              </div>
            </div>
            <div class="coding-status">
              <div class="coding-day">
                <span class="label">Coding Day:</span>
                <span class="value">Tuesday</span>
              </div>
              <div class="coding-day">
                <span class="label">Plate Ending:</span>
                <span class="value">4</span>
              </div>
              <div class="coding-alert">
                <span class="iconify" data-icon="mdi:alert-circle"></span>
                <span>Cannot drive during peak hours on Tuesdays</span>
              </div>
            </div>
          </div>

          <!-- Quick Tips -->
          <div class="coding-tips">
            <h4><span class="iconify" data-icon="mdi:lightbulb"></span> Important Reminders</h4>
            <ul>
              <li>Coding applies to all vehicles except those with special exemptions</li>
              <li>Weekends and public holidays are coding-free days</li>
              <li>Violations may result in fines and penalties</li>
              <li>Plan your trips accordingly to avoid coding hours</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- DETAILS MODAL -->
      <div class="modal" id="detailsModal">
        <div class="modal-content modal-xl">
          <div class="modal-header">
            <div>
              <h3>Ongoing Booking Details</h3>
              <p class="reference">ID: 272625528262818</p>
            </div>

            <button
              id="close-modal"
              class="close-modal"
              onclick="closeModal('detailsModal')"
            >
              <span class="iconify" data-icon="mdi:close"></span>
            </button>
          </div>
          <!-- MODAL BODY FOR ONGOING BOOKING-->
          <div class="modal-body details-modal-body">
            <div class="booking-details">
              <!-- PASSENGER DETAILS -->
              <div class="passenger-details">
                <div class="passenger-info">
                  <div class="passenger-text-info">
                    <div class="avatar-large">JS</div>
                    <div class="">
                      <h3>John Smith</h3>
                      <p>09*********</p>
                    </div>
                  </div>
                  <div class="passenger-actions">
                    <button class="btn-call">
                      <span class="iconify" data-icon="mdi:phone"></span>
                    </button>
                    <button class="btn-message">
                      <a href="message.html"><span class="iconify" data-icon="mdi:message-text"></span></a>
                    </button>
                  </div>
                </div>
                <div class="route-info">
                  <h4>Route Information</h4>
                  <div class="route-details">
                    <div class="route-item">
                      <div class="location-section">
                        <div class="location-item">
                          <span
                            class="iconify pickup-icon"
                            data-icon="ic:outline-circle"
                          ></span>
                          <div class="location-text">
                            <span class="location-label">Pick-up Location</span>
                            <span class="location-name">SM North EDSA</span>
                          </div>
                        </div>
                        <div class="route-stats">
                          <button onclick="openInGoogleMaps(this)">
                            <span
                              class="iconify"
                              data-icon="tabler:location-filled"
                            ></span>
                          </button>
                        </div>
                      </div>
                    </div>

                    <div class="route-item">
                      <div class="location-section">
                        <div class="location-item">
                          <span
                            class="iconify dropoff-icon"
                            data-icon="mdi:location"
                          ></span>
                          <div class="location-text">
                            <span class="location-label"
                              >Drop-off Location</span
                            >
                            <span class="location-name">QC Circle</span>
                          </div>
                        </div>
                        <div class="route-stats">
                          <button onclick="openInGoogleMaps(this)">
                            <span
                              class="iconify"
                              data-icon="tabler:location-filled"
                            ></span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- TRIP DETAILS -->
                <div class="trip-details">
                  <h4>Trip Details</h4>
                  <div class="trip-info">
                    <div class="trip-item">
                      <span class="trip-label">Date & Time</span>
                      <span class="trip-value">Sept 15, 2025 • 08:30 AM</span>
                    </div>
                    <div class="trip-item">
                      <span class="trip-label">Payment Method</span>
                      <span class="trip-value">Cash</span>
                    </div>
                    <div class="total-fare">
                      <h4>Total Fare</h4>
                      <div class="fare-amount">₱126</div>
                    </div>
                  </div>
                </div>

                <!-- TOTAL FARE -->

                <!-- BOOKING COMMENTS -->
                <div class="details-note">
                  <h4>Note</h4>
                  <div class="comment-section">
                    <div class="details-note-text">
                      Lorem ipsum dolor sit amet consectetur adipisicing elit.
                      Maiores dicta vero itaque aliquid, placeat eius! Sed,
                      aspernatur est odio incidunt soluta eveniet consequuntur
                      nesciunt sapiente odit aliquam officia, eum voluptatibus.
                      Sed, magni perferendis cum id perspiciatis quisquam nulla
                      nemo facilis aperiam temporibus delectus iste? Molestiae
                      officiis soluta et sit excepturi, accusantium accusamus
                      harum quis vitae adipisci explicabo aut laboriosam
                      exercitationem.
                    </div>
                  </div>
                </div>

                <!-- ACTION BUTTONS -->
                <div class="modal-actions">
                  <!-- Arrived at pickup(Arrived at pickup),Arrived at Destination(Arrived at dropoff) -->
                  <button id="togglePickup" class="btn-completed">
                    Arrived at Pickup
                  </button>

                  <!-- Hide Cancel Booking after pickup -->
                  <button class="btn-cancel" id="cancelRide">
                    Cancel Booking
                  </button>
                </div>
              </div>
              <!-- MAP -->
              <div class="map-section">
                <div id="map">
                  <p id="pickup-location" style="display: none">
                    Marilao Bulacan
                  </p>
                  <p id="dropoff-location" style="display: none">Makati City</p>
                </div>
              </div>
            </div>
          </div>

          <!-- MODAL CONFIRMATION-->
          <!-- Arrived at Pickup Modal -->
          <div id="arrivedPickupModal" class="modal">
            <div class="modal-content modal-sm">
              <!-- Header -->
              <div class="modal-header">
                <h3 id="headerText">Confirm Arrival</h3>
                <button
                  class="close-modal"
                  onclick="closeModal('arrivedPickupModal')"
                >
                  &times;
                </button>
              </div>

              <div class="modal-body">
                <p id="confirmationText" class="confirmation-text">
                  Are you sure you’ve arrived at the passenger’s pickup
                  location?
                </p>
              </div>

              <!-- Footer -->
              <div class="modal-footer">
                <button
                  class="modal-btn secondary"
                  onclick="closeModal('arrivedPickupModal')"
                  id="cancelArrivalBtn"
                >
                  Cancel
                </button>
                <button
                  class="modal-btn"
                  id="confirmArrivalBtn"
                  onclick="confirmArrival()"
                >
                  Yes, Arrived
                </button>

                <button
                  class="modal-btn"
                  id="confirmDropoffBtn"
                  style="display: none"
                  onclick="confirmDropoffArrival()"
                >
                  Yes, Arrived
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- BOOKING ACCEPTED -->
      <div class="modal" id="bookingAccepted">
        <div class="modal-content modal-sm">
          <!-- Header -->
          <div class="modal-header">
            <h3 id="headerText">Ride Confirmed!</h3>
            <button class="close-modal" onclick="closeModal('bookingAccepted')">
              &times;
            </button>
          </div>

          <div class="modal-body">
            <p id="confirmationText" class="confirmation-text">
              Proceed to the passenger’s pickup point.
            </p>
          </div>

          <!-- Footer -->
          <div class="modal-footer">
            <button
              class="modal-btn secondary"
              onclick="confirmBookingAndShowDetails()"
              id="cancelArrivalBtn"
            >
              Okay
            </button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="js/script.js"></script>
    <script type="module" src="js/map.js"></script>
    <script type="module" src="js/booking.js"></script>
  </body>
</html>
